<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="initial-scale=1,width=device-width"><link rel=icon type=image/png sizes=32x32 href=/blog/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicons/favicon-16x16.png><link rel="shortcut icon" href=/blog/favicons/favicon.ico><title>Iota tricks | Anaminus.Blog</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Iota tricks | Anaminus.Blog"><meta name=twitter:description content="Using Go's iota for questionable reasons."><meta name=twitter:image content="https://anaminus.github.io/blog/favicons/favicon-512x512.png"><meta property="og:type" content="website"><meta property="og:title" content="Iota tricks | Anaminus.Blog"><meta property="og:description" content="Using Go's iota for questionable reasons."><meta property="og:image" content="https://anaminus.github.io/blog/favicons/favicon-512x512.png"><link rel=stylesheet href=/blog/main.min.ec8850f9fe3ad746e212254e26de9fd02b07508eb40640aa7bd0e787afd42ba9.css integrity="sha256-7IhQ+f4610biEiVOJt6f0CsHUI60BkCqe9Dnh6/UK6k=" crossorigin=anonymous></head><body><header><a href=/blog/><svg class="header" width="43" height="9" viewBox="0 0 43 9"><title>Logo with title ".Blog"</title><path class="logo" d="m2 1v1H1v3h1v3h1V7h1v1h1V5h1V2H5V1H4v1H3V1zm0 2h1v1H2zm2 0h1v1H4z"/><path class="title" d="m13 1v7h4V7h-3V5h3V4h-3V2h3V1zm4 1v2h1V2zm0 3v2h1V5zm2-2v5h5V7h-4V3zm7 0v1h3V3zm3 1v3h1V4zm0 3h-3v1h3zm-3 0V4h-1v3zm6-4v1h4V3zm0 1h-1v3h1zm0 3v1h3V7zm3 0h1V5h-3v1h2zM9 7v1h1V7z"/><path class="cursor" d="m37 8h5v1h-5z"/></svg></a></header><main><nav><a href=/blog/posts/>Posts</a></nav><article><header><div class=title><h1>Iota tricks</h1><span class=date>Published on <time>2025-09-26</time></span></div><div class=subtitle><div class=description>Using Go's iota for questionable reasons.</div><span class=tags><a class=tag href=/blog/tags/go/>#go</a></span></div></header><p>Go has a neat syntax called <a href=https://go.dev/ref/spec#Iota>iota</a>, which sequentially increments for
constants in the same group:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=c1>// int = 0, defaults to int type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=c1>// int = 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w>        </span><span class=c1>// int = 2, uses previous value, which is iota</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w>        </span><span class=c1>// int = 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>The most common pattern is to have the first define the rest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w> </span><span class=kt>uint</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=c1>// uint = 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w>             </span><span class=c1>// uint = 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w>             </span><span class=c1>// uint = 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w>             </span><span class=c1>// uint = 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>E</span><span class=w>             </span><span class=c1>// uint = 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>For completely irrational reasons, I like to define a blank constant that uses
iota, then have the actual constants filled in automatically. The blank, which
is discarded, defines the expression to be used for the remaining values. Math
is allowed, so 1 can be subtracted to get the actual constants to have the
correct values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=c1>// int = -1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w>            </span><span class=c1>// int =  0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w>            </span><span class=c1>// int =  1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w>            </span><span class=c1>// int =  2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w>            </span><span class=c1>// int =  3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Nice and consistent. There&rsquo;s a problem, though. An error occurs for unsigned
types, because they&rsquo;re not allowed to underflow:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// cannot use iota - 1 (untyped int constant -1)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// as uint value in constant declaration (overflows)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=kt>uint</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><p>This can be fixed by using the <a href=https://go.dev/ref/spec#Min_and_max>max</a> function to clamp the value. Since
it&rsquo;s built-in, it can be used on constants:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=w> </span><span class=kt>uint</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=kc>iota</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=c1>// uint = 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w>                       </span><span class=c1>// uint = 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w>                       </span><span class=c1>// uint = 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w>                       </span><span class=c1>// uint = 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w>                       </span><span class=c1>// uint = 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=flags>Flags</h2><p>Flags are another common pattern, which involves defining powers of two:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=c1>// int = 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w>             </span><span class=c1>// int = 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w>             </span><span class=c1>// int = 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w>             </span><span class=c1>// int = 8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>When formatting this to use a blank constant, a similar problem arises:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// invalid operation: negative shift count (iota - 1)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// (untyped int constant -1)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=p>(</span><span class=kc>iota</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>To fix this, instead of subtracting 1, divide by two, which has the same effect:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=kc>iota</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=c1>// uint = 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w>                   </span><span class=c1>// uint = 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w>                   </span><span class=c1>// uint = 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w>                   </span><span class=c1>// uint = 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w>                   </span><span class=c1>// uint = 8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>In short,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// For sequences.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=kc>iota</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w> </span><span class=c1>// 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w> </span><span class=c1>// 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w> </span><span class=c1>// 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w> </span><span class=c1>// 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// For flags.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=kc>iota</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>A</span><span class=w> </span><span class=c1>// 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>B</span><span class=w> </span><span class=c1>// 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>C</span><span class=w> </span><span class=c1>// 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>D</span><span class=w> </span><span class=c1>// 8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div></article></main><footer><span class=license>Content is licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA-4.0</a><a class=feed-icon title="RSS feed" href=/blog/index.xml><svg width="128" height="128" viewBox="0 0 256 256"><path d="m92 189a24 24 0 01-24 24 24 24 0 01-24-24 24 24 0 0124-24 24 24 0 0124 24z"/><path d="m160 213h-34a82 82 0 00-82-82V97a116 116 0 01116 116z"/><path d="M184 213A140 140 0 0044 73V38a175 175 0 01175 175z"/></svg></a></span>
<span class=publication><svg viewBox="0 0 7 7" width="7" height="7"><path d="m2 0v1H1v3h1v3h1V6h1v1h1V4h1V1H5V0H4v1H3V0zm0 2h1v1H2zm2 0h1v1H4z"/></svg> 2022–2025 <a href=https://anaminus.github.io/>Anaminus</a></span></footer></body></html>