<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="initial-scale=1,width=device-width"><link rel=icon type=image/png sizes=32x32 href=/blog/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicons/favicon-16x16.png><link rel="shortcut icon" href=/blog/favicons/favicon.ico><title>Dumping all my tweets | Anaminus.Blog</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Dumping all my tweets | Anaminus.Blog"><meta name=twitter:description content="In which I add 15 years of tweets to my blog."><meta name=twitter:image content="https://anaminus.github.io/blog/favicons/favicon-512x512.png"><meta property="og:type" content="website"><meta property="og:title" content="Dumping all my tweets | Anaminus.Blog"><meta property="og:description" content="In which I add 15 years of tweets to my blog."><meta property="og:image" content="https://anaminus.github.io/blog/favicons/favicon-512x512.png"><link rel=stylesheet href=/blog/main.min.ca70a43ffa905155dd0834469ae9edebadaa11453b9af809dc9ac93aeafd262b.css integrity="sha256-ynCkP/qQUVXdCDRGmunt662qEUU7mvgJ3JrJOur9Jis=" crossorigin=anonymous></head><body><header><a href=/blog/><svg class="header" width="43" height="9" viewBox="0 0 43 9"><title>Logo with title ".Blog"</title><path class="logo" d="m2 1v1H1v3h1v3h1V7h1v1h1V5h1V2H5V1H4v1H3V1zm0 2h1v1H2zm2 0h1v1H4z"/><path class="title" d="m13 1v7h4V7h-3V5h3V4h-3V2h3V1zm4 1v2h1V2zm0 3v2h1V5zm2-2v5h5V7h-4V3zm7 0v1h3V3zm3 1v3h1V4zm0 3h-3v1h3zm-3 0V4h-1v3zm6-4v1h4V3zm0 1h-1v3h1zm0 3v1h3V7zm3 0h1V5h-3v1h2zM9 7v1h1V7z"/><path class="cursor" d="m37 8h5v1h-5z"/></svg></a></header><main><nav><a href=/blog/posts/>Posts</a></nav><article><header><div class=title><h1>Dumping all my tweets</h1><span class=date>Published on <time>2025-09-16</time></span></div><div class=subtitle><div class=description>In which I add 15 years of tweets to my blog.</div><span class=tags><a class=tag href=/blog/tags/meta/>#meta</a></span></div></header><blockquote><p>What if I were to dump all my tweets into my blog, which will involve coming
up with titles and tags for every single one of them?</p><p>&mdash; Me (idiot)</p></blockquote><p>The thing about social media is that your content isn&rsquo;t really yours. If your
platform of choice randomly, algorithmically, or hallucinatorily decides to nuke
your account, all of that content you made is gone.</p><p>I like to assume that I&rsquo;ve said some pretty good stuff over the years, so it
would be a shame if any of that were to disappear. If I&rsquo;m not in control of my
<a href=https://twitter.com/Anaminus>Twitter</a>, I am in control of my blog. What would it take to convert every
tweet into a blog post?</p><h2 id=step-one-export>Step one: export</h2><p>First, I need to get an archive of all my tweets. Fortunately I already had one
lying around that&rsquo;s fairly recent, so I&rsquo;ll just use that.</p><p>What about other social media? I also have a <a href=https://bsky.app/profile/anaminus.bsky.social>BlueSky</a> and
<a href=https://mastodon.gamedev.place/@anaminus>Mastodon</a> account, but those have mostly been mirroring Twitter. There
may be some platform-exclusive replies, but I can look through those manually.
Most reply-type posts wont make the cut anyway.</p><h2 id=step-two-parse>Step two: parse</h2><p>Next, I need to write a script to parse this exported data. My default language
of choice is <a href=https://go.dev/>Go</a>, which compiles so fast that I regularly use
it for one-off scripting.</p><p>The first thing to do is to figure out where the meat is. The archive
conveniently provides a local web-based interface for browsing the data, so
there&rsquo;s a lot of HTML and JavaScript files lying around. Fortunately, there&rsquo;s
also a README that explains the content of the archive in an amount of detail
that is refreshingly surprising. Hats off to whoever took the time to do that.</p><p>Anyway, the important file is <code>tweets.js</code>. While this is a javascript file, it
contains mostly JSON. Specifically, the root value is an array, but it also has
JS code to assign this array to some field:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>YTD</span><span class=p>.</span><span class=nx>tweets</span><span class=p>.</span><span class=nx>part0</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;tweet&#34;</span> <span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>By trimming the file up to the first <code>[</code>, the assignment is removed, and now I
have a pure-JSON file to parse.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Data</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=cp>//TODO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>f</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>f</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>f</span><span class=p>[</span><span class=nx>bytes</span><span class=p>.</span><span class=nf>Index</span><span class=p>(</span><span class=nx>f</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>byte</span><span class=p>{</span><span class=sc>&#39;[&#39;</span><span class=p>}):]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>var</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=p>[]</span><span class=nx>Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>d</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nf>NewDecoder</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nf>NewReader</span><span class=p>(</span><span class=nx>f</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nf>Decode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>data</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>...</span><span class=w>
</span></span></span></code></pre></div><p>Next is to fill out this Data struct by inspecting the structure of the JSON and
deciding which parts are important. Since this is a one-off, I&rsquo;m keeping the
structure extremely simple. If I&rsquo;m using UnmarshalJSON, then I&rsquo;m doing it wrong.</p><p>Here&rsquo;s the structure, which only contains relevant fields that I will actually
be using:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Data</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Structure is two levels deep. Probably for</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// forward compatibility purposes which I,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// for one, appreciate.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Tweet</span><span class=w> </span><span class=nx>Tweet</span><span class=w> </span><span class=s>`json:&#34;tweet&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>Tweet</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Unique identifier that appears in URLs.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Will be used as key for mapping.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ID</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;id&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Timestamp. Unparsed now because it&#39;s easier</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// to just do it later.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>CreatedAt</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;created_at&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// The raw content of the tweet.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>FullText</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;full_text&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Various interpreted portions of the text,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// such as media, URLs, mentions, and</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// hashtags.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>NEntities</span><span class=w> </span><span class=nx>Entities</span><span class=w> </span><span class=s>`json:&#34;entities&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Entities</span><span class=w>  </span><span class=nx>Entities</span><span class=w> </span><span class=s>`json:&#34;extended_entities&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ID of tweet this tweet is replying to, if</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// applicable. When the ID is another tweet in</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// this archive, this can be used to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// reconstruct threads.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ReplyTo</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;in_reply_to_status_id&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// User name of the tweet being replied to.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Needed for generating links.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ReplyName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;in_reply_to_screen_name&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Next, I&rsquo;ll take these Tweet structs and convert them into a structure that
better fits my blog. I&rsquo;m calling such posts &ldquo;briefs&rdquo; (🩲), so that will be the
name of the struct:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Brief</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Unique ID, corresponding to Tweet.ID.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ID</span><span class=w> </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Parsed date.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Date</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Final content, after applying various</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// transformations.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Content</span><span class=w> </span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Reply ID, corresponding to Tweet.ReplyTo.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ReplyTo</span><span class=w> </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Corresponds to Tweet.ReplyName.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ReplyName</span><span class=w> </span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// List of IDs replying to this post.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Replies</span><span class=w> </span><span class=p>[]</span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Associated media.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Media</span><span class=w> </span><span class=o>*</span><span class=nx>BriefMedia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>I originally assumed that a tweet can only have one piece of media attached, so
the Media field only allows zero or one values. While it turns out that more
than one can be attached, I only ever used this feature once, so I just handled
that one tweet manually.</p><h3 id=media>Media</h3><p>Media is produced by inspecting the <code>Entities</code> fields. There are two fields:
<code>entities</code> and <code>extended_entities</code>. The first one contains text-related things
like mentions, hashtags, and URLs, and images as well. The extended entities
appears to contain only media-type things, including images. That is, the same
image object will appear in both fields, so it&rsquo;s important to only handle one of
them to avoid duplicates. Since I&rsquo;m dealing only with media at this point, I
only need to consider <code>extended_entities</code>.</p><p>Getting the right media is somewhat involved. The <code>type</code> field indicates one of
<code>photo</code>, <code>animated_gif</code> or <code>video</code>. The first two are pretty straightforward,
with the <code>media_url</code> field corresponding to the actual file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;extended_entities&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;media&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;photo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;media_url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://pbs.twimg.com/.../photo.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=err>...</span>
</span></span></code></pre></div><p>Videos, on the other hand, have multiple formats, several of them being images.
I want to select the best file that is an actual video, because that is what is
stored in the archive. In this case, I want to ignore <code>media_url</code>. The
<code>video_info.variants</code> field lists variations. The best file will be the variant
with the greatest <code>bitrate</code> field (if it has one at all). The URL is just the
<code>url</code> field.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;extended_entities&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;media&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;video&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;video_info&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;variants&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;bitrate&#34;</span> <span class=p>:</span> <span class=s2>&#34;2176000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;content_type&#34;</span> <span class=p>:</span> <span class=s2>&#34;video/mp4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;url&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://video.twimg.com/.../video.mp4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=err>...</span>
</span></span></code></pre></div><p>Regardles of file type, to get a path to the file in the archive, I have to
parse the media URL, get the base file name of the path, append it to the ID of
the tweet, then join it with the media path in the archive. For example:</p><pre tabindex=0><code>Base from URL:                         smtZI8u_MFMb0-ie.mp4
ID:                1783949913195159552
Path: tweets_media/1783949913195159552-smtZI8u_MFMb0-ie.mp4
</code></pre><h3 id=content>Content</h3><p>Rendering the content of a tweet is interesting, because entities are used to
replace the raw text. Each entity has an <code>indices</code> field that is an array of two
integers, which indicates the range of characters (not bytes) in the raw text
that represents the entity.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Only includes entities I&#39;m interested in.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>Entities</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// I want to replace the shortened URL with</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// the actual URL.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>URLs</span><span class=w> </span><span class=p>[]</span><span class=nx>URL</span><span class=w> </span><span class=s>`json:&#34;urls&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// I want to remove any media URLs entirely,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// since they will be inlined anyway.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Media</span><span class=w> </span><span class=p>[]</span><span class=nx>Media</span><span class=w> </span><span class=s>`json:&#34;media&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>URL</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Indices</span><span class=w> </span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;indices&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>Media</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Indices</span><span class=w> </span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&#34;indices&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>To handle these different types doing similar things, I define a <code>Replacer</code>
interface to be implemented by each entity type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Replacer</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>ReplaceIndices</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>ReplaceWith</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>To render the content, I round up all entities into an array as Replacers. This
array is sorted by the first index so that replacers are applied in the correct
order. Then, the content is built piece by piece:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>replacers</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Last index of the previous replacer, or the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// start of the text.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>z</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=p>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>z</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>replacers</span><span class=p>[</span><span class=nx>i</span><span class=o>-</span><span class=mi>1</span><span class=p>].</span><span class=nf>ReplaceIndices</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// First index of the current replacer.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nf>ReplaceIndices</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Write the unreplaced text between the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// previous and current replacer.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>z</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>content</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nf>uslice</span><span class=p>(</span><span class=nx>t</span><span class=p>.</span><span class=nx>FullText</span><span class=p>,</span><span class=w> </span><span class=nx>z</span><span class=p>,</span><span class=w> </span><span class=nx>a</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Write the replaced text.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>content</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>ReplaceWith</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Write the unreplaced text after the last</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// replacer.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>replacers</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=nx>replacers</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>].</span><span class=nf>ReplaceIndices</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>content</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nf>uslicex</span><span class=p>(</span><span class=nx>t</span><span class=p>.</span><span class=nx>FullText</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>))</span><span class=w>
</span></span></span></code></pre></div><p>The <code>uslice</code> functions simply slice a string across characters instead of bytes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Does the compiler recognize these patterns?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>uslice</span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nb>string</span><span class=p>([]</span><span class=nb>rune</span><span class=p>(</span><span class=nx>s</span><span class=p>)[</span><span class=nx>a</span><span class=p>:</span><span class=nx>b</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>uslicex</span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nb>string</span><span class=p>([]</span><span class=nb>rune</span><span class=p>(</span><span class=nx>s</span><span class=p>)[</span><span class=nx>a</span><span class=p>:])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Finally, any leading and trailing whitespace is trimmed. The result is also run
through a text wrapper, since that&rsquo;s what I prefer, and don&rsquo;t want to have to do
it myself for every single post.</p><h3 id=generate-files>Generate files</h3><p>To build a tree of replies, I add all posts to a <code>briefs</code> map, inspect each
ReplyTo field, and add to the replied post&rsquo;s list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>briefs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=o>*</span><span class=nx>Brief</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>d</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Convert Data to Brief.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>tw</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>Tweet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>id</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>atoi</span><span class=p>(</span><span class=nx>tw</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>briefs</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Brief</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>ID</span><span class=p>:</span><span class=w>        </span><span class=nx>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>ReplyTo</span><span class=p>:</span><span class=w>   </span><span class=nf>atoi</span><span class=p>(</span><span class=nx>tw</span><span class=p>.</span><span class=nx>ReplyTo</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>ReplyName</span><span class=p>:</span><span class=w> </span><span class=nx>tw</span><span class=p>.</span><span class=nx>ReplyName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// &#34;Mon Jan 02 15:04:05 -0700 2006&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>Date</span><span class=p>:</span><span class=w> </span><span class=nx>tw</span><span class=p>.</span><span class=nf>Date</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// Renders content.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>Content</span><span class=p>:</span><span class=w> </span><span class=nx>tw</span><span class=p>.</span><span class=nf>Content</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// Produces media.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>Media</span><span class=p>:</span><span class=w> </span><span class=nx>tw</span><span class=p>.</span><span class=nf>Media</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Build reply tree.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>id</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>briefs</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>r</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>briefs</span><span class=p>[</span><span class=nx>b</span><span class=p>.</span><span class=nx>ReplyTo</span><span class=p>];</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>r</span><span class=p>.</span><span class=nx>Replies</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Replies</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Next is to sort the posts by ID, which naturally sorts by date.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>ids</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>slices</span><span class=p>.</span><span class=nf>Collect</span><span class=p>(</span><span class=nx>maps</span><span class=p>.</span><span class=nf>Keys</span><span class=p>(</span><span class=nx>briefs</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>slices</span><span class=p>.</span><span class=nf>Sort</span><span class=p>(</span><span class=nx>ids</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>ids</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>brief</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>briefs</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>briefs</span><span class=p>[</span><span class=nx>brief</span><span class=p>.</span><span class=nx>ReplyTo</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// Is reply to another brief that was</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// handled previously.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>continue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>...</span><span class=w>
</span></span></span></code></pre></div><p>Self-reply posts are skipped, because I&rsquo;ll be combining threads of tweets into a
single post. Originally, I had threads as a distinct type of post with their own
formatting, but decided that this would be too difficult to handle during manual
processing. Not all related tweets are directly associated, so it&rsquo;s easier to
inspect if they&rsquo;re all next to each other on the same timeline.</p><p>To generate posts, I use a <code>postBuilder</code> struct. This contains a
<code>strings.Builder</code> along with needed context, like other posts and related media.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>postBuilder</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Content of post file.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>b</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Maps unique ID to post.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>briefs</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=o>*</span><span class=nx>Brief</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Maps media object to file name.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>media</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=o>*</span><span class=nx>BriefMedia</span><span class=p>]</span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>When a post includes media, it needs to be bundled with the post. First, I have
a function that finds all media in the post tree:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Recursively populates a list of media files.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>postBuilder</span><span class=p>)</span><span class=w> </span><span class=nf>findMedia</span><span class=p>(</span><span class=nx>brief</span><span class=w> </span><span class=o>*</span><span class=nx>Brief</span><span class=p>,</span><span class=w> </span><span class=nx>media</span><span class=w> </span><span class=o>*</span><span class=p>[]</span><span class=o>*</span><span class=nx>BriefMedia</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>brief</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>Media</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=o>*</span><span class=nx>media</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=o>*</span><span class=nx>media</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>Media</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>Replies</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>p</span><span class=p>.</span><span class=nf>findMedia</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>briefs</span><span class=p>[</span><span class=nx>r</span><span class=p>],</span><span class=w> </span><span class=nx>media</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Then, I decide whether the post should be a single file or a bundle based on the
presence of media:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>out</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>&#34;../content/briefs&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>media</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>BriefMedia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>builder</span><span class=p>.</span><span class=nf>findMedia</span><span class=p>(</span><span class=nx>brief</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>media</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>media</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>out</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>out</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nf>Filename</span><span class=p>()</span><span class=o>+</span><span class=s>&#34;.md&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>out</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>out</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nf>Filename</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;index.md&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>os</span><span class=p>.</span><span class=nf>MkdirAll</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Dir</span><span class=p>(</span><span class=nx>out</span><span class=p>),</span><span class=w> </span><span class=mo>0755</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Then I have to locate and copy the media files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>media</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ContentFile is already pointing to the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// correct location of the media file in the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// archive, starting from the directory of</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// tweets.js.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>contentPath</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Dir</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Args</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>ContentFile</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// A simple number is used as the filename.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>name</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%02d%s&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Ext</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>outputPath</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Dir</span><span class=p>(</span><span class=nx>out</span><span class=p>),</span><span class=w> </span><span class=nx>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Open the input and output files, then copy.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>cin</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>contentPath</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>cout</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>outputPath</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>io</span><span class=p>.</span><span class=nf>Copy</span><span class=p>(</span><span class=nx>cout</span><span class=p>,</span><span class=w> </span><span class=nx>cin</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>cin</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>cout</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Map the media to the filename so that the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// builder knows which name to use when</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// generating references to the media.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>builder</span><span class=p>.</span><span class=nx>media</span><span class=p>[</span><span class=nx>m</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Finally, the content of the post is generated.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>postBuilder</span><span class=p>)</span><span class=w> </span><span class=nf>build</span><span class=p>(</span><span class=nx>brief</span><span class=w> </span><span class=o>*</span><span class=nx>Brief</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Generate front matter.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;+++\n&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=s>&#34;title = %q\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nf>Filename</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=s>&#34;date = %s\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>Date</span><span class=p>.</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;2006-01-02 15:04:05&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;tags = []\n&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>ReplyTo</span><span class=w> </span><span class=p>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;[params]\n&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=s>&#34;replyto = \&#34;https://twitter.com/%s/status/%d\&#34;\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>ReplyName</span><span class=p>,</span><span class=w> </span><span class=nx>brief</span><span class=p>.</span><span class=nx>ReplyTo</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;+++&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Write content.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>p</span><span class=p>.</span><span class=nf>section</span><span class=p>(</span><span class=nx>brief</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>p</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;\n&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>If the post is a reply to an external tweet, then a link to the tweet is
generated in the front matter, which will be rendered by the post template. This
is an addition to make manual processing a little easier.</p><p>Instead of producing posts for each tweet, the entire reply tree is flattened
and written together. The <code>section</code> method basically writes the Content field of
the post, generates markup for displaying media if there is any, then calls
<code>section</code> on each reply to the post.</p><p>For the name of each post file, I decided to just use the timestamp up to the
minute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=nx>Brief</span><span class=p>)</span><span class=w> </span><span class=nf>Filename</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>Date</span><span class=p>.</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;200601021504&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This makes each post somewhat hard to identify at a glance within a file
explorer, but it&rsquo;s the best way to ensure that every file is unique.</p><p>After running this script, the final result is a lot of new files under
<code>content/briefs</code> of my blog&rsquo;s repository.</p><h2 id=step-three-the-hard-part>Step three: the hard part</h2><p>The final step is to manually walk through each generated post, and decide what
to with it.</p><p>The thing is, when I said &ldquo;a lot&rdquo;, apparently I meant approximately <strong>4,000</strong>
(that&rsquo;s as many as four thousands, and that&rsquo;s terrible). Having already
processed over a hundred posts, &ldquo;a lot&rdquo; is starting to feel like an
understatement.</p><blockquote><p>no, lol</p><p>&mdash; Me, in response to &ldquo;Just have an AI do it&rdquo;</p></blockquote><p>Anyway, here are some techniques I&rsquo;m applying to make the process easier:</p><h3 id=generate-as-much-as-possible>Generate as much as possible</h3><p>The front matter is already mostly filled in. I just need to replace the title,
fill in the tags, and remove a reply parameter, if present.</p><p>The content is mostly well-formatted. Threads of tweets are grouped into the
same file. Each tweet is a paragraph, and any media is placed in its own block.
Long lines are already wrapped to 80 characters. URLs may have to be adjusted,
but they&rsquo;re usually placed at the end of the tweet, so it&rsquo;s easy enough to move
them onto their own line.</p><p>Mentions are usually removed. Sometimes, if it feels relevant enough, I might
include a tweet from someone else as a quote. This might be the most manual
part, but it hasn&rsquo;t been too bad so far.</p><h3 id=include-context>Include context</h3><p>Many posts are replies to tweets from other people, which wont appear in my
archive. It&rsquo;s good to have the context, so I render a link to the reply when
available. This is the purpose of the <code>replyto</code> parameter in the front matter:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{- if .Params.replyto }}
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;{{.Params.replyto}}&#34;</span> <span class=na>target</span><span class=o>=</span><span class=s>&#34;_blank&#34;</span><span class=p>&gt;</span>⤷ Reply<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{{- end }}
</span></span></code></pre></div><p>This makes it very easy to view the tweet, and include it as a quote, if
desired.</p><h3 id=make-posts-easy-to-view-alongside-each-other>Make posts easy to view alongside each other</h3><p>It&rsquo;s a lot easier to determine whether or not a number of tweets are related
when they&rsquo;re displayed right next to each other. I&rsquo;m already rendering posts in
a timeline on the <a href=/blog/briefs/>briefs</a> page, so I just reuse that
by serving my blog locally.</p><h3 id=make-posts-easy-to-edit>Make posts easy to edit</h3><p>Since I&rsquo;m viewing posts through my browser, I would like a streamlined way to
edit them. I&rsquo;m not going to write a whole-ass browser extension for it, though.
After some research, I found that Firefox has a config that lets you use View
Source to open files in an external editor.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Enable external view-source editor.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>user_pref</span><span class=p>(</span><span class=s2>&#34;view_source.editor.external&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Set path to preferred editor.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>user_pref</span><span class=p>(</span><span class=s2>&#34;view_source.editor.path&#34;</span><span class=p>,</span> <span class=s2>&#34;/usr/bin/subl&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>That&rsquo;s great, but I need to be able to get to the file in the first place.
Firefox will interpret <code>file://</code> links, but it requires some more configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Enable policy.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>user_pref</span><span class=p>(</span><span class=s2>&#34;capability.policy.policynames&#34;</span><span class=p>,</span> <span class=s2>&#34;localfilelinks&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Needed for reasons I&#39;m not interested in looking up.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>user_pref</span><span class=p>(</span><span class=s2>&#34;capability.policy.localfilelinks.checkloaduri.enabled&#34;</span><span class=p>,</span> <span class=s2>&#34;allAccess&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Add local Hugo-served blog to whitelist.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>user_pref</span><span class=p>(</span><span class=s2>&#34;capability.policy.localfilelinks.sites&#34;</span><span class=p>,</span> <span class=s2>&#34;http://localhost:1313&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>Then, when rendering a post locally, I&rsquo;ve added a link to the actual file.
<code>target=_blank</code> forces the file to be opened in a new tab, which means I can
left-click instead of middle-click, which is slightly easier.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{- if hugo.IsDevelopment -}}
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;file://{{.File.Filename}}&#34;</span> <span class=na>target</span><span class=o>=</span><span class=s>&#34;_blank&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		{{- .File.ContentBaseName -}}
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{{- end -}}
</span></span></code></pre></div><p>After opening the file, I can right-click and select View Page Source, and the
file now appears directly in my editor.</p><h2 id=step-four-conclude>Step four: conclude</h2><p>After churning though a hundred of these posts at once, I got sick of the whole
thing for an entire day. So I&rsquo;ve determind that I&rsquo;ll have to go through them
little by little. Surely I&rsquo;ll get through them all eventually. Oh, by the way,</p><p>Am I deleting my social media posts once I&rsquo;m done?</p><p>No!</p><p>Will I stop posting there and only make posts here from now on?</p><p>No!</p><p>As long as a platform doesn&rsquo;t require me to upload my face and government ID
(for real, wtf), you&rsquo;ll still find me posting there. Consider this website to be
yet another mirror.</p></article></main><footer><span class=license>Content is licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA-4.0</a><a class=feed-icon title="RSS feed" href=/blog/index.xml><svg width="128" height="128" viewBox="0 0 256 256"><path d="m92 189a24 24 0 01-24 24 24 24 0 01-24-24 24 24 0 0124-24 24 24 0 0124 24z"/><path d="m160 213h-34a82 82 0 00-82-82V97a116 116 0 01116 116z"/><path d="M184 213A140 140 0 0044 73V38a175 175 0 01175 175z"/></svg></a></span>
<span class=publication><svg viewBox="0 0 7 7" width="7" height="7"><path d="m2 0v1H1v3h1v3h1V6h1v1h1V4h1V1H5V0H4v1H3V0zm0 2h1v1H2zm2 0h1v1H4z"/></svg> 2022–2025 <a href=https://anaminus.github.io/>Anaminus</a></span></footer></body></html>