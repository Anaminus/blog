<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="initial-scale=1,width=device-width"><link rel=icon type=image/png sizes=32x32 href=/blog/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicons/favicon-16x16.png><link rel="shortcut icon" href=/blog/favicons/favicon.ico><title>Securing secret branches | Anaminus.Blog</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Securing secret branches | Anaminus.Blog"><meta name=twitter:description content="How to make sure you don't git-push the wrong thing."><meta name=twitter:image content="https://anaminus.github.io/blog/favicons/favicon-512x512.png"><meta property="og:type" content="website"><meta property="og:title" content="Securing secret branches | Anaminus.Blog"><meta property="og:description" content="How to make sure you don't git-push the wrong thing."><meta property="og:image" content="https://anaminus.github.io/blog/favicons/favicon-512x512.png"><link rel=stylesheet href=/blog/main.min.16ceb0141d8f7e04e75c651bd7215ced1b7614a865809c6d7db73a2c7c4986c9.css integrity="sha256-Fs6wFB2PfgTnXGUb1yFc7Rt2FKhlgJxtfbc6LHxJhsk=" crossorigin=anonymous></head><body><header><a href=https://anaminus.github.io/blog/><svg class="header" width="43" height="9" viewBox="0 0 43 9"><title>Logo with title ".Blog"</title><path class="logo" d="m2 1v1H1v3h1v3h1V7h1v1h1V5h1V2H5V1H4v1H3V1zm0 2h1v1H2zm2 0h1v1H4z"/><path class="title" d="m13 1v7h4V7h-3V5h3V4h-3V2h3V1zm4 1v2h1V2zm0 3v2h1V5zm2-2v5h5V7h-4V3zm7 0v1h3V3zm3 1v3h1V4zm0 3h-3v1h3zm-3 0V4h-1v3zm6-4v1h4V3zm0 1h-1v3h1zm0 3v1h3V7zm3 0h1V5h-3v1h2zM9 7v1h1V7z"/><path class="cursor" d="m37 8h5v1h-5z"/></svg></a></header><main><nav><a href=https://anaminus.github.io/blog/posts/>Posts</a></nav><article><header><div class=title><h1>Securing secret branches</h1><span class=date>Published on <time>2022-11-06</time></span></div><div class=subtitle><div class=description>How to make sure you don't git-push the wrong thing.</div><span class=tags><a class=tag href=https://anaminus.github.io/blog/tags/github/>#github</a>
<a class=tag href=https://anaminus.github.io/blog/tags/git/>#git</a></span></div></header><p>Most posts I write will never be published. But I still keep them around
locally, because they often contain useful bits that will likely find their way
into another post.</p><p>The blog is managed by git. When I want to publish a new post, I just commit and
push (&ldquo;pushlish&rdquo;?). I keep drafts on a separate branch that stays local.</p><p>But how do I make sure it stays local? I don&rsquo;t want to accidentally push super
secret drafts to GitHub! Fortunately, GitHub has what are called &ldquo;Protection
rules&rdquo;.</p><p>To set it up, first the branch needs to be on GitHub. It&rsquo;s easy enough to create
a new branch on the website by going to the <code>/branches</code> page.</p><figure><img src=/blog/posts/secret-branch/fig1.png width=284 height=113 loading=lazy></figure><p>The branch has to be based off of another one. I used the same branch as what my
local <code>drafts</code> branch is based off of. This will make accidental pulls safe,
since git will just think the local branch is the latest.</p><p>Next, I went to Settings, then Branches, and added a new Branch protection rule,
where the pattern matched the name of the branch:</p><figure><img src=/blog/posts/secret-branch/fig2.png width=795 height=229 loading=lazy></figure><p>Then I included the Lock branch rule. This will prevent me from pushing to it. I
also included the &ldquo;Do not allow bypassing above settings&rdquo;. Seems like a safe
thing to do.</p><figure><img src=/blog/posts/secret-branch/fig3.png width=793 height=183 loading=lazy></figure><p>Saved the rule, and that&rsquo;s it.</p><figure><img src=/blog/posts/secret-branch/fig4.png width=794 height=150 loading=lazy></figure><p>Now when I try to push to the branch, GitHub will reject the attempt.</p><figure><img src=/blog/posts/secret-branch/fig5.png width=458 height=246 loading=lazy></figure><p>Notably, git still tries to upload everything, and the rejection comes
afterwards. I could add a local pre-push hook to prevent the uploading, but I&rsquo;m
not worried about it. The point is to prevent the drafts from becoming public,
which has already been accomplished.</p></article></main><footer><span class=license>Content is licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA-4.0</a><a class=feed-icon title="RSS feed" href=https://anaminus.github.io/blog/index.xml><svg width="128" height="128" viewBox="0 0 256 256"><path d="m92 189a24 24 0 01-24 24 24 24 0 01-24-24 24 24 0 0124-24 24 24 0 0124 24z"/><path d="m160 213h-34a82 82 0 00-82-82V97a116 116 0 01116 116z"/><path d="M184 213A140 140 0 0044 73V38a175 175 0 01175 175z"/></svg></a></span>
<span class=publication><svg viewBox="0 0 7 7" width="7" height="7"><path d="m2 0v1H1v3h1v3h1V6h1v1h1V4h1V1H5V0H4v1H3V0zm0 2h1v1H2zm2 0h1v1H4z"/></svg> 2022â€“2025 <a href=https://anaminus.github.io/>Anaminus</a></span></footer></body></html>